{% extends "layout.html" %}

{% block title %}{{ message.title }}{% endblock %}

{% block content %}
<h1>{{ message.title }}</h1>

{% if session.user_id == message.user_id %}
  <p>
    <a href="/edit_message/{{ message.id }}">Muokkaa</a>
    <a href="/remove_message/{{ message.id }}">Poista</a>
  </p>
{% endif %}

<p>{{ message.description | replace('\n', '<br>') | safe }}</p>
<p>Ikä: {{ user.age }} vuotta</p>
<p>
  Käyttäjä:
  {% if session.user_id %}
    <a href="/user/{{ message.user_id }}">{{ message.username }}  {{ message.user_age }} vuotta</a>
  {% else %}
    Kirjaudu nähdäksesi käyttäjän
  {% endif %}
</p>

{% if classes %}
  <p>Luokat:</p>
  <ul>
    {% for class in classes %}
      <li>{{ class.title }}: {{ class.value }}</li>
    {% endfor %}
  </ul>
{% endif %}

<hr>

{% if session.user_id %}
  {% if session.user_id != message.user_id %}
    <p><a href="/start_thread/{{ message.id }}">Aloita keskustelu ilmoittajan kanssa</a></p>
  {% else %}
    <h2>Viestiketjut</h2>
    {% if threads %}
      {% for thread in threads %}
        <p>
          <a href="/thread/{{ thread.id }}">
            {% if thread.user1_id == session.user_id %}
              {{ thread.user2_name }}
            {% else %}
              {{ thread.user1_name }}
            {% endif %}
          </a>
        </p>
      {% endfor %}
    {% else %}
      <p>Ei vielä viestiketjuja.</p>
    {% endif %}
  {% endif %}
{% else %}
  <p><a href="/login">Kirjaudu lähettääksesi viesti käyttäjälle</a></p>
{% endif %}

<p><a href="/">Takaisin</a></p>
{% endblock %}

